var daysOfWeek=["Monday","Tuesday","Wednesday","Thursday","Friday"];var timesOfDay=["8:00am","9:00am","10:00am","11:00am","12:00pm","1:00pm","2:00pm","3:00pm","4:00pm","5:00pm","6:00pm","7:00pm","8:00pm","9:00pm"];var allcolors=["#D9EDF7","#0D63B6","#CC333F","#317A22","#E5924C","#C34B5F","#4682B4","#228B22","#EE3B3B","#6E7B8B","#7584B5"];var colors=["#004A61","#008789","#FC4349","#F0F0F0","#444444"]
var TOP_MARGIN="0px";var LEFT_MARGIN="0px";var RIGHT_MARGIN="0px";var BOTTOM_MARGIN="0px";var CELL_WIDTH=130;var CELL_HEIGHT=50;var CANVAS_WIDTH=780;var CANVAS_HEIGHT=750;var colorCounter=0;var pngOn=false;var courseName="";var searchIsOn=false;var ajaxCallSent=false;var courseRectangles=new Array();var sectionsGrabbed=new Array();var canvasItem,canvasContext;var courseListing;var xPos,yPos;var url;var sectionListing=new Array();$(document).ready(function(){initializeCanvas();});function createImage(canvas){try{url=canvas.toDataURL();var imgDiv=document.getElementById("canvasImage");var newImg=document.createElement("img");newImg.src=url;newImg.height=730;newImg.width=780;newImg.alt="Your Fall Class Schedule via Course Picker by Jane Ullah";imgDiv.appendChild(newImg);}catch(e){console.log("Failed to write image of canvas.");}}
function updateListeners(ctx,courseRectangles){$("#scheduleCanvas").on("click",function(e){var x,y;if(e.offsetX==undefined){x=Math.floor(e.pageX-$("#scheduleCanvas").offset().left);y=Math.floor(e.pageY-$("#scheduleCanvas").offset().top);}else{x=e.offsetX;y=e.offsetY;}
try{Object.keys(courseRectangles).forEach(function(key){var classmtg=courseRectangles[key];if(classmtg.xCoord<x&&classmtg.yCoord<y&&classmtg.xCoord+CELL_WIDTH>x&&classmtg.yCoord+classmtg.rectangleHeight>y){console.log("Point is within "+classmtg.callNumber);$('.courseinfo').remove();triggerOverlay(classmtg,e.pageX,e.pageY);throw true;}});}catch(e){if(e!==true){console.log("Error enumerating list of sections.");}}});}
function triggerOverlay(classmtg,x,y){var topMargin;var canvasDiv=document.getElementById("canvasDiv");var courseinfodiv=document.createElement("div");courseinfodiv.setAttribute("class","courseinfo");courseinfodiv.setAttribute("id","courseInfoDiv");var leftMargin=classmtg.xCoord;if(classmtg.yCoord>480){topMargin=250;}else{topMargin=700-classmtg.yCoord;}
var style="margin-left: "+leftMargin+"px; margin-top: -"+topMargin+"px;";courseinfodiv.setAttribute("style",style);var courseName=document.createTextNode(classmtg.courseName);var courseLecturer=document.createTextNode("Lecturer: "+classmtg.lecturer);var startTime=document.createTextNode("Start: "+classmtg.startHour+":"+classmtg.startMinute);var endTime=document.createTextNode("End: "+classmtg.endHour+":"+classmtg.endMinute);var courseCredit=document.createTextNode("Credits: "+classmtg.courseCredit);var br1=document.createElement("br");var br2=document.createElement("br");var br3=document.createElement("br");var br4=document.createElement("br");courseinfodiv.appendChild(courseName);courseinfodiv.appendChild(br1);courseinfodiv.appendChild(courseLecturer);courseinfodiv.appendChild(br2);courseinfodiv.appendChild(startTime);courseinfodiv.appendChild(br3);courseinfodiv.appendChild(endTime);courseinfodiv.appendChild(br4);courseinfodiv.appendChild(courseCredit);canvasDiv.appendChild(courseinfodiv);}
function findYCoord(startHour){if(startHour==8){return CELL_HEIGHT;}else if(startHour==9){return CELL_HEIGHT*2;}else if(startHour==10){return CELL_HEIGHT*3;}else if(startHour==11){return CELL_HEIGHT*4;}else if(startHour==12){return CELL_HEIGHT*5;}else if(startHour==13){return CELL_HEIGHT*6;}else if(startHour==14){return CELL_HEIGHT*7;}else if(startHour==15){return CELL_HEIGHT*8;}else if(startHour==16){return CELL_HEIGHT*9;}else if(startHour==17){return CELL_HEIGHT*10;}else if(startHour==18){return CELL_HEIGHT*11;}else if(startHour==19){return CELL_HEIGHT*12;}else if(startHour==20){return CELL_HEIGHT*13;}else if(startHour==21){return CELL_HEIGHT*14;}else{return CELL_HEIGHT*15;}}
function drawClassMeeting(ctx){try{var schedule=jQuery.parseJSON(sched);Object.keys(schedule).forEach(function(key){parseSection(schedule[key],ctx);colorCounter++;if(colorCounter==(colors.length-1)){colorCounter=0;}});}catch(e){console.log("Internal error: jQuery could not convert the list of sections to a Javascript object. Please try again.");}}
function parseSection(section,ctx){var coursePrefix=section.coursePrefix;var courseNumber=section.courseNumber;var callNumber=section.callNumber;Object.keys(section.meetings).forEach(function(key){var meeting=section.meetings[key];var dash=meeting.indexOf("-");var startHour,startMinute,endHour,endMinute;if(meeting.charAt(0)==0){startHour=parseInt(meeting.substring(1,2));}else{startHour=parseInt(meeting.substring(0,2));}
startMinute=parseInt(meeting.substring(2,dash));if(meeting.substring(dash+1,dash+3).charAt(0)==0){endHour=parseInt(meeting.substring(dash+2,dash+3));}else{endHour=parseInt(meeting.substring(dash+1,dash+3));}
if(meeting.substring(dash+3,dash+5).charAt(0)==0){endMinute=parseInt(meeting.substring(dash+4,dash+5));}else{endMinute=parseInt(meeting.substring(dash+3,dash+5));}
var xCoord=0;var yCoord=0;if(key.localeCompare("M")==0){xCoord=CELL_WIDTH;}else if(key.localeCompare("T")==0){xCoord=CELL_WIDTH*2;}else if(key.localeCompare("W")==0){xCoord=CELL_WIDTH*3;}else if(key.localeCompare("R")==0){xCoord=CELL_WIDTH*4;}else if(key.localeCompare("F")==0){xCoord=CELL_WIDTH*5;}
var startAMPM=meeting.charAt(4);var endAMPM=meeting.charAt(10);if(startAMPM=='P'&&startHour!=12){startHour+=12;}
if(endAMPM=="P"&&endHour!=12){endHour+=12;}
yCoord=findY(startHour,startMinute);if(!isNaN(startHour)||!isNaN(endHour)||!isNaN(yCoord)){drawMeeting(xCoord,yCoord,ctx,coursePrefix+" "+courseNumber,callNumber,startMinute,endMinute,startHour,endHour,section.courseName,section.courseCredit,section.courseLecturer);}});}
function findY(hour,minute){var yCoord=findYCoord(hour);if(minute/15==0){yCoord=yCoord;}else if(minute/15==1){yCoord=yCoord+CELL_HEIGHT/4;}else if(minute/15==2){yCoord=yCoord+2*(CELL_HEIGHT/4);}else if(minute/15==3){yCoord=yCoord+3*(CELL_HEIGHT/4);}else if(minute/10==1){yCoord=yCoord+CELL_HEIGHT/6;}else if(minute/10==2){yCoord=yCoord+2*(CELL_HEIGHT/6);}else if(minute/10==4){yCoord=yCoord+4*(CELL_HEIGHT/6);}else if(minute/10==5){yCoord=yCoord+5*(CELL_HEIGHT/6);}else if(minute/5==1){yCoord=yCoord+CELL_HEIGHT/12;}else if(minute/5==5){yCoord=yCoord+5*(CELL_HEIGHT/12);}else if(minute/5==7){yCoord=yCoord+7*(CELL_HEIGHT/12);}else if(minute/5==11){yCoord=yCoord+11*(CELL_HEIGHT/12);}
return yCoord;}
function findHeight(hourDiff,startMin,endMin){var startPixels=CELL_HEIGHT-(startMin*CELL_HEIGHT)/60;var endPixels=(endMin*CELL_HEIGHT)/60;var block=CELL_HEIGHT;if(hourDiff>1){block=hourDiff*CELL_HEIGHT;return block+endPixels}else if(hourDiff==0){return((endMin-startMin)*CELL_HEIGHT)/60;}else{return startPixels+endPixels;}}
function drawMeeting(x,y,ctx,text,callNumber,startMinute,endMinute,startHour,endHour,courseName,courseCredit,lecturer){ctx.fillStyle=colors[colorCounter];ctx.beginPath();var height=findHeight((endHour-startHour),startMinute,endMinute);ctx.rect(x,y,CELL_WIDTH,height);ctx.fill();ctx.font="bold 16px Georgia";ctx.fillStyle="#f0f0f0";ctx.textAlign='center';ctx.fillText(text,x+55,y+20);ctx.fillText(callNumber,x+40,y+35);ctx.lineWidth=2;ctx.strokeStyle='#000000';ctx.stroke();var meetingObject={"xCoord":x,"yCoord":y,"rectangleHeight":height,"callNumber":callNumber,"courseInfo":text,"courseName":courseName,"courseCredit":courseCredit,"lecturer":lecturer,"startHour":startHour,"startMinute":startMinute,"endHour":endHour,"endMinute":endMinute};courseRectangles.push(meetingObject);}
function initializeCanvas(){var c=document.getElementById("scheduleCanvas");var ctx=c.getContext("2d");for(var x=CELL_WIDTH;x<=650;x+=CELL_WIDTH){ctx.lineWidth=2;ctx.strokeStyle="#000000";ctx.moveTo(x,0);ctx.lineTo(x,750);ctx.stroke();}
for(var y=CELL_HEIGHT;y<=730;y+=CELL_HEIGHT){ctx.lineWidth=2;ctx.strokeStyle="#000000";ctx.moveTo(0,y);ctx.lineTo(780,y);ctx.stroke();}
ctx.font="16px Georgia";var y=CELL_HEIGHT+30;for(var counter=0;counter<14;counter++){ctx.fillText(timesOfDay[counter],25,y);y+=CELL_HEIGHT;}
var x=CELL_WIDTH+10;for(var counter=0;counter<5;counter++){ctx.fillText(daysOfWeek[counter],x,25);x+=CELL_WIDTH+5;}
courseRectangles=new Array();sectionsGrabbed=new Array();drawClassMeeting(ctx);canvasContext=ctx;canvasItem=c;}